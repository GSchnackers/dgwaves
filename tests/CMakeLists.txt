
FILE(GLOB GEOFILES 2d/*.geo 3d/*.geo)
SET(PROGS2D explore edges)
SET(PROGS3D explore faces)

FOREACH(GEOFILE ${GEOFILES})
    GET_FILENAME_COMPONENT(GEOFILE_NAME ${GEOFILE} NAME)
    #MESSAGE("processing ${GEOFILE}")
    IF(${GEOFILE} MATCHES ".+/2d/.+")
        SET(FLAG "2")
        SET(PROGS ${PROGS2D})
    ELSE()
        SET(FLAG "3")
        SET(PROGS ${PROGS3D})
    ENDIF()
    STRING(REPLACE ".geo" ".msh" MSHFILE_NAME "${GEOFILE_NAME}")
    ADD_TEST(NAME ${MSHFILE_NAME} COMMAND ${GMSH_EXECUTABLE} "-${FLAG}" ${GEOFILE} -o ${MSHFILE_NAME})
    #MESSAGE("adding ${MSHFILE_NAME} (${FLAG}D)")
    FOREACH(PROG ${PROGS})
        STRING(CONCAT JOINED ${PROG} "_" ${MSHFILE_NAME})
        ADD_TEST(NAME ${JOINED} COMMAND ${PROG} ${MSHFILE_NAME})
        SET_TESTS_PROPERTIES(${JOINED} PROPERTIES DEPENDS ${MSHFILE_NAME})
    ENDFOREACH()
ENDFOREACH()


